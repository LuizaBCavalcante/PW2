<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::head}, ~{::main}, 'Meu Carrinho')}">
<head th:replace="~{fragments/head :: head(~{}, ~{::title})}">
    <title>Carrinho</title>
</head>
<main>
    <div th:if="${mensagemErro}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${mensagemErro}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${mensagemSucesso}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div class="container mt-4">

        <table class="table table-striped table-hover mt-3">
            <thead class="table-dark">
            <tr>
                <th>Produto</th>
                <th>Preço Unit.</th>
                <th>Qtd</th>
                <th>Subtotal</th>
                <th>Ação</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item, stat : ${session.venda.itemVendas}">
                <td th:text="${item.produto.descricao}"></td>

                <td th:text="'R$ ' + ${#numbers.formatDecimal(item.valor, 1, 'POINT', 2, 'COMMA')}"></td>

                <td style="width: 150px;">
                    <div class="input-group input-group-sm">

                        <a th:href="@{/venda/diminuir/{id}(id=${item.produto.id})}"
                           class="btn btn-outline-secondary"
                           type="button">
                            ➖
                        </a>

                        <input type="text" class="form-control text-center"
                               th:value="${item.quantidade}" readonly>

                        <a th:href="@{/venda/adicionar/{id}(id=${item.produto.id})}"
                           class="btn btn-outline-secondary"
                           type="button">
                            ➕
                        </a>
                    </div>
                </td>

                <td th:text="'R$ ' + ${#numbers.formatDecimal(item.total(), 1, 'POINT', 2, 'COMMA')}"></td>

                <td>
                    <a th:href="@{/venda/remove/{index}(index=${stat.index})}"
                       class="btn btn-danger btn-sm">Remover</a>
                </td>
            </tr>

            <tr th:if="${session.venda.itemVendas.isEmpty()}">
                <td colspan="5" class="text-center">Seu carrinho está vazio.</td>
            </tr>
            </tbody>
            <tfoot>
            <tr class="table-secondary">
                <td colspan="3" class="text-end fw-bold">TOTAL GERAL:</td>
                <td class="fw-bold fs-5 text-success" th:text="'R$ ' + ${#numbers.formatDecimal(session.venda.total(), 1, 'POINT', 2, 'COMMA')}">R$ 0.00</td>
                <td></td>
            </tr>
            </tfoot>
        </table>

        <hr>

        <div class="card p-4 bg-light" th:if="${!session.venda.itemVendas.isEmpty()}">
            <h4>Finalizar Compra</h4>
            <form th:action="@{/venda/finalizar}" method="POST">

                <div class="mb-3">
                    <label for="cliente" class="form-label">Selecione o Cliente:</label>
                    <select name="clienteId" id="cliente" class="form-select">
                        <option value="">-- Escolha um Cliente --</option>
                        <option th:each="c : ${clientes}"
                                th:value="${c.id}"
                                th:text="${c.getNomeCliente()}"></option>
                    </select>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success btn-lg">Concluir Pedido</button>
                </div>
            </form>
        </div>

        <div class="mt-3">
            <a th:href="@{/produto/home}" class="btn btn-outline-primary">Continuar Comprando</a>
        </div>

    </div>
</main>
</html>